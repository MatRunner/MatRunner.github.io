<script src="ANCESTRY.js"></script>
<script>
  var ancestry=JSON.parse(ANCESTRY_FILE)
  function average(arr){
    let sum=0
    for(let i=0;i<arr.length;i++){
      sum+=arr[i]
    }
    return sum/arr.length
  }
  function findSomeone(name){//找人函数，返回这个人
    var person=ancestry.filter(x=>x.name==name)
    return person[0]
  }
  var momInAncestry=ancestry.filter(x=>findSomeone(x.mother))//找出妈在族谱里的人
  var ageDifference=momInAncestry.map(x=>x.born-findSomeone(x.mother).born)//找出他们的年龄差并建立一个数组
  var aveAgeDiff=average(ageDifference)//31.2
  console.log('平均生娃年龄：'+aveAgeDiff)
  console.log('================================================================================')
  var centruyGroup={}
  ancestry.forEach(x=>{
    if(Math.ceil(x.died/100) in centruyGroup){
      centruyGroup[Math.ceil(x.died/100)].push(x.died-x.born)
    }else{
      centruyGroup[Math.ceil(x.died/100)]=[x.died-x.born]
    }
  })
  console.log('世纪','平均年龄')
  for(let key in centruyGroup){
    console.log(key,average(centruyGroup[key]))
  }
  console.log('================================================================================')
  function groupBy(arr,f){
    var obj={}
    arr.forEach(x=>{
      if(f(x) in obj){
        obj[f(x)].push(x)
      }else{
        obj[f(x)]=[x]
      }
    })
    return obj
  }
  console.log('GroupBy',groupBy(ancestry,x=>Math.ceil(x.died/100)))
  console.log('=================================================================================')
  function every(arr,test){
    return arr.reduce((a,b)=>test(a)&&test(b),true)
  }
  function some(arr,test){
    return arr.reduce((a,b)=>test(a)||test(b))
  }
  function every2(arr,test){
    return !some(arr,x=>!test(x))
  }
  function some2(arr,test){
    return !every(arr,x=>!test(x))//摩根定律可别用错了：!(A&B)==!A|!B  !(A|B)==!A&!B
  }
  console.log('==================================================================================')
  function keyBy(arr,f){//一个f返回分类标准
    return arr.reduce((map,item)=>{
      var key=f(item)
      map[key]=item
      return map
    },{})
  }
  console.log('==================================================================================')
  var byName={}
  ancestry.forEach(x=>{
    byName[x.name]=x
  })
  console.log(byName)
  console.log('===================================================================================')
  //一个函数，功能为计算一个人和他祖先的基因相似度，如果是我写的话，接收参数要有这个人的人名，和他祖先的名字，一个计算基因是如何传递的函数,一个如果查找不到这个人时的默认值，函数内部实现的是根据人名向父母查找直至查找到祖先
  function myReduceAncestors(person,target){//当然我太拉了，默认均分遗传写了个简单的
    if(person==target){
      return 1
    }
    if(!(person in byName)){
      return 0
    }
    return (myReduceAncestors(byName[person].mother,target)+myReduceAncestors(byName[person].father,target))/2
  }
  //==========================================================
  function ReduceAncestors(person,f,defaultVal){
    function valFor(person){
      if(person==null){
        return defaultVal
      }else{
        return f(person,valFor(byName[person.mother]),valFor(byName[person.father]))//f函数计算的是一个人和父母间的基因关系,是传入的参数之一
      }
    }
    return valFor(person)
  }
</script>